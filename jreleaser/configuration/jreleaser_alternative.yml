# Overall this config file is the same as the jreleaser_automatic.yml
# but it uses a different `stagingRepositories` (`build` instead of `target`).
#
# `stagingRepositories` cannot be parameterized, hence we need to keep two versions of the file.
release:
  github:
    skipTag: false
    skipRelease: false
    tagName: '{{tagName}}'
    overwrite: true
    commitAuthor:
      name: 'Hibernate CI'
      email: 'ci@hibernate.org'
    changelog:
      enabled: true
      formatted: ALWAYS
      # This file is generated by the release scripts depending on the project that is released.
      contentTemplate: .release/scripts/jreleaser/changelog.tpl

# File signing is always active
signing:
  mode: COMMAND
  active: RELEASE
  armored: true

deploy:
  maven:
    mavenCentral:
      maven-central:
        active: RELEASE
        url: https://central.sonatype.com/api/v1/publisher
        snapshotSupported: false
        applyMavenCentralRules: true
        stagingRepositories:
          - build/staging-deploy/maven
hooks:
  script:
    before:
      # Note that this hook is only applicable for the "release" event when we want to push all our local changes to remote (GitHub)
      #  before JReleaser creates the changelog and tags.
      - continueOnError: false
        # This condition prevents the hook from running if we haven't passed the branch to it:
        condition: '"{{ currentBranch }}" != ""'
        verbose: true
        shell: SH
        run: 'git push origin HEAD:{{currentBranch}}'
        filter:
          includes: ['release']
